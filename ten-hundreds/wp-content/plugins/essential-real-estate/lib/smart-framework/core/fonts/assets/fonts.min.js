var GSF_Fonts=GSF_Fonts||{};(function(a){"use strict";GSF_Fonts={_loadFontCount:0,_fonts:{},_isSubmitting:false,_icon_spin:"gsf-icon-spinner",init:function(){this.tabClick();this.binderFonts();this.searchFonts();this.events()},events:function(){a(".gsf-reset-active-fonts").on("click",function(t){t.preventDefault();if(!confirm(GSF_META_DATA.msgConfirmResetFont)){return}if(GSF_Fonts._isSubmitting){return}GSF_Fonts._isSubmitting=true;var n=a(this);n.find("i").addClass(GSF_Fonts._icon_spin);a.ajax({url:GSF_META_DATA.ajaxUrl,data:{action:"gsf_reset_active_font",_nonce:GSF_META_DATA.nonce},type:"post",success:function(t){n.find("i").removeClass(GSF_Fonts._icon_spin);GSF_Fonts._isSubmitting=false;if(t.success){GSF_Fonts.bindActiveFont()}else{alert(t.data)}},error:function(){n.find("i").removeClass(GSF_Fonts._icon_spin);GSF_Fonts._isSubmitting=false}})})},binderFonts:function(){var t=["google","standard","custom"];for(var n in t){this.bindFonts(t[n])}this.bindActiveFont()},getFontFamily:function(t){if(t.indexOf(",")!=-1){return t}if(t.indexOf(" ")!=-1){return"'"+t+"'"}return t},enqueueFont:function(t){var n="";switch(t.kind){case"webfonts#webfont":{n="https://fonts.googleapis.com/css?family="+t.family.replace(" ","+")+":100,200,300,400,500,600,700,800,900,1000";break}case"custom":{n=typeof t.css_url!=="undefined"?t.css_url:GSF_META_DATA.font_url+t.css_file;break}}if(n!==""){a("body").append('<link class="gsf-preview-css-font" rel="stylesheet" href="'+n+'" type="text/css" media="all" />')}},bindFonts:function(e,o){if(o==null){o=false}var t=a(".gsf-fonts-wrapper").data("nonce");a.ajax({url:GSF_META_DATA.ajaxUrl,data:{action:"gsf_get_font_list",_nonce:GSF_META_DATA.nonce,font_type:e},type:"get",success:function(t){if(!t.success){return}GSF_Fonts._fonts[t.data.font_type]=t.data.fonts.items;var n;switch(t.data.font_type){case"google":{n=wp.template("gsf-google-fonts");break}case"standard":{n=wp.template("gsf-standard-fonts");break}case"custom":{n=wp.template("gsf-custom-fonts");break}}if(n){var s=a(".gsf-font-listing-inner"),i=a(n(t.data));a("#"+e+"_fonts").remove();s.append(i);GSF_Fonts.addEventListener(i);i.find(".gsf-font-categories li a").first().trigger("click");if(o){i.show()}}GSF_Fonts._loadFontCount++},error:function(){GSF_Fonts._loadFontCount++}})},addEventListener:function(s){s.find("form").ajaxForm({beforeSubmit:function(){if(GSF_Fonts._isSubmitting){return false}s.find("form").find("button i").addClass(GSF_Fonts._icon_spin);GSF_Fonts._isSubmitting=true},success:function(t){s.find("form").find("button i").removeClass(GSF_Fonts._icon_spin);GSF_Fonts._isSubmitting=false;if(t.success){GSF_Fonts.bindFonts("custom",true);a("#gsf-custom-font-popup").find(".mfp-close").trigger("click")}else{alert(t.data)}}});s.find(".gsf-font-categories li a").on("click",function(){var t=a(this),n=t.parent().data("ref");s.find(".gsf-font-categories li").removeClass("active");t.parent().addClass("active");GSF_Fonts.filterFontsByCate(s,n);a("#search_fonts").val("")});s.find(".gsf-add-custom-font button").on("click",function(){a.magnificPopup.open({items:{src:"#gsf-custom-font-popup",type:"inline"},mainClass:"mfp-move-horizontal",callbacks:{open:function(){this.content.find("form")[0].reset()}},openDelay:0,removalDelay:100,midClick:true})});s.find(".gsf-font-item-action-delete").on("click",function(t){t.preventDefault();if(!confirm(GSF_META_DATA.msgConfirmDeleteCustomFont)){return}if(GSF_Fonts._isSubmitting){return}GSF_Fonts._isSubmitting=true;var n=a(this),s=n.closest(".gsf-font-item").data("name");n.find("i").addClass(GSF_Fonts._icon_spin);a.ajax({url:GSF_META_DATA.ajaxUrl,data:{action:"gsf_delete_custom_font",_nonce:GSF_META_DATA.nonce,family_name:s},type:"post",success:function(t){n.find("i").removeClass(GSF_Fonts._icon_spin);GSF_Fonts._isSubmitting=false;if(t.success){GSF_Fonts.bindFonts("custom",true)}else{alert(t.data)}},error:function(){n.find("i").removeClass(GSF_Fonts._icon_spin);GSF_Fonts._isSubmitting=false}})});s.find(".gsf-font-item-action-add").on("click",function(t){t.preventDefault();var n=a(this),s=n.data("type"),i=n.closest(".gsf-font-item").data("name"),e=GSF_Fonts.findFontSource(GSF_Fonts._fonts[s],i);if(e==null){return}if(n.find("i").hasClass("dashicons-yes")){return}if(GSF_Fonts._isSubmitting){return true}GSF_Fonts._isSubmitting=true;n.find("i").addClass(GSF_Fonts._icon_spin);a.ajax({url:GSF_META_DATA.ajaxUrl,data:{action:"gsf_using_font",_nonce:GSF_META_DATA.nonce,font_data:e},type:"post",success:function(t){GSF_Fonts._isSubmitting=false;n.find("i").removeClass(GSF_Fonts._icon_spin);if(t.success){n.find("i").attr("class","dashicons dashicons-yes");GSF_Fonts.bindActiveFont()}else{alert(t.data)}},error:function(){GSF_Fonts._isSubmitting=false;n.find("i").removeClass(GSF_Fonts._icon_spin)}})})},bindActiveFont:function(){var t=a(".gsf-fonts-wrapper").data("nonce");a.ajax({url:GSF_META_DATA.ajaxUrl,data:{action:"gsf_get_font_list",_nonce:GSF_META_DATA.nonce,font_type:"active"},type:"get",success:function(t){if(!t.success){return}GSF_Fonts._fonts[t.data.font_type]=t.data.fonts.items;var n=wp.template("gsf-active-fonts");if(n){var s=a(".gsf-font-active-listing"),i=a(n(t.data));a("#active_fonts").remove();s.append(i);GSF_Fonts.activeFontAddEventListener(i);a(".gsf-preview-css-font").remove();for(var e in t.data.fonts.items){GSF_Fonts.enqueueFont(t.data.fonts.items[e])}}},error:function(){}})},activeFontAddEventListener:function(n){n.find(".gsf-font-active-item-header").on("click",function(t){if(a(t.target).closest(".gsf-font-active-item-remove").length){return}a(this).toggleClass("in");a(this).next(".gsf-font-active-content").slideToggle()});n.find(".gsf-font-active-item-remove").on("click",function(t){t.preventDefault();if(!confirm(GSF_META_DATA.msgConfirmRemoveActiveFont)){return}var n=a(this),s=n.closest(".gsf-font-active-item"),i=s.data("name");if(GSF_Fonts._isSubmitting){return true}GSF_Fonts._isSubmitting=true;n.find("i").addClass(GSF_Fonts._icon_spin);a.ajax({url:GSF_META_DATA.ajaxUrl,data:{action:"gsf_remove_active_font",_nonce:GSF_META_DATA.nonce,family_name:i},type:"post",success:function(t){GSF_Fonts._isSubmitting=false;n.find("i").removeClass(GSF_Fonts._icon_spin);if(t.success){a('.gsf-font-item[data-name="'+t.data.family+'"]').find(".gsf-font-item-action-add i").attr("class","dashicons dashicons-plus-alt2");GSF_Fonts.bindActiveFont()}else{alert(t.data)}},error:function(){GSF_Fonts._isSubmitting=false;n.find("i").removeClass(GSF_Fonts._icon_spin)}})});n.find("form").ajaxForm({beforeSubmit:function(){if(GSF_Fonts._isSubmitting){return false}n.find("form").find("button i").addClass(GSF_Fonts._icon_spin);GSF_Fonts._isSubmitting=true},success:function(t){n.find("form").find("button i").removeClass(GSF_Fonts._icon_spin);GSF_Fonts._isSubmitting=false;if(!t.success){alert(t.data)}}})},findFontSource:function(t,n){for(var s in t){if(t[s].family==n){return t[s]}}return null},filterFontsByCate:function(t,n){var s=t.find(".gsf-font-item");s.each(function(){var t=a(this);if(t.data("category")!==n){t.hide()}else{t.show()}})},filterFontByKeyWord:function(t,s){var n=t.find(".gsf-font-item");n.each(function(){var t=a(this),n=t.find(".gsf-font-item-name").text();try{if(n.search(new RegExp(s,"i"))<0){t.hide()}else{t.show()}}catch(t){}})},searchFonts:function(){a("#search_fonts").on("keyup",function(t){var n=a(".gsf-font-container:visible"),s=a(this).val();n.find(".gsf-font-categories li").removeClass("active");GSF_Fonts.filterFontByKeyWord(n,s)})},tabClick:function(){a(".gsf-font-type > li > a").on("click",function(t){t.preventDefault();if(GSF_Fonts._loadFontCount<3){return}var n=a(this);if(n.parent().hasClass("active")){return}var s=a(this).data("ref");a(".gsf-font-type > li").removeClass("active");n.parent().addClass("active");a(".gsf-font-container").each(function(){var t=a(this);if(t.data("ref")!=s){t.slideUp()}});a("#"+s+"_fonts").slideDown(function(){if(a("#"+s+"_fonts").find(".gsf-font-categories li a").length){a("#"+s+"_fonts").find(".gsf-font-categories li a").first().trigger("click")}else{a("#search_fonts").val("");a("#search_fonts").trigger("keyup")}})})}};a(document).ready(function(){GSF_Fonts.init()})})(jQuery);