var GSF_ICON_POPUP=GSF_ICON_POPUP||{};!function(s){"use strict";GSF_ICON_POPUP={_$popup:[],_callback:function(){},_currentFontId:0,_fonts:[],_currentSection:"",_currentIcon:"",init:function(){GSF_ICON_POPUP._$popup=s("#gsf-popup-icon-wrapper"),0===GSF_ICON_POPUP._$popup.length&&s.ajax({url:GSF_POPUP_DATA.ajaxUrl,type:"post",data:{action:"gsf_get_font_icons",nonce:GSF_POPUP_DATA.nonce},success:function(n){var o,t,i,p,P,_=JSON.parse(n),c=wp.template("gsf-icons-popup");if(GSF_ICON_POPUP._fonts=_,0!=s("#tmpl-gsf-icons-popup").length){for(o in _){0===GSF_ICON_POPUP._currentFontId&&(GSF_ICON_POPUP._currentFontId=o);var r={};for(_[o].groups=[],i=_[o].iconGroup.length,t=0;t<i;t++)for(P=_[o].iconGroup[t].icons.length,_[o].groups[_[o].iconGroup[t].id]=_[o].iconGroup[t].icons,p=0;p<P;p++)r[_[o].iconGroup[t].icons[p]]=!0;for(var e in _[o].groups[""]=[],r)_[o].groups[""].push(e)}var u=c(_);for(o in s("body").append(u),_)delete GSF_ICON_POPUP._fonts[o].iconGroup,delete GSF_ICON_POPUP._fonts[o].label,delete GSF_ICON_POPUP._fonts[o].total;GSF_ICON_POPUP._fonts=_,GSF_ICON_POPUP._$popup=s("#gsf-popup-icon-wrapper"),GSF_ICON_POPUP.settingPopup(),GSF_ICON_POPUP.popupListener()}}}),GSF_ICON_POPUP.svg_icon(),s("body").on("gsf_field_control_changed",function(n){GSF_ICON_POPUP.svg_icon()})},settingPopup:function(){var n=this._$popup.find(".gsf-popup-icon-font-link-inner"),o=n.find(".gsf-popup-icon-group-link"),t=this._$popup.find(".gsf-popup-icon-group-section"),i=this._$popup.find(".gsf-popup-icon-listing");n.perfectScrollbar({wheelSpeed:.5,suppressScrollX:!0}),i.perfectScrollbar({wheelSpeed:.5,suppressScrollX:!0}),o.css("display","none"),o.first().css("display","block"),t.css("display","none"),t.first().css("display","block")},popupListener:function(){var i=GSF_ICON_POPUP._$popup.find(".gsf-popup-icon-search > input"),n=GSF_ICON_POPUP._$popup.find(".gsf-popup-icon-group-link a"),p=GSF_ICON_POPUP._$popup.find(".gsf-popup-icon-group-title"),o=GSF_ICON_POPUP._$popup.find(".gsf-popup-icon-font > select");i.on("keyup",function(){var o=s(this).val().toLowerCase();(GSF_ICON_POPUP._currentSection="")===o?p.text(p.data("msg-all")):p.text(p.data("msg-search").replace("{0}",o));var n=[];GSF_ICON_POPUP._fonts[GSF_ICON_POPUP._currentFontId]&&GSF_ICON_POPUP._fonts[GSF_ICON_POPUP._currentFontId].groups&&(n=GSF_ICON_POPUP._fonts[GSF_ICON_POPUP._currentFontId].groups[""].filter(function(n){return-1!==n.indexOf(o)})),GSF_ICON_POPUP.bindListFont(n,!1),GSF_ICON_POPUP.updateListingScroll()}),n.on("click",function(){var n=s(this),o=n.data("id");GSF_ICON_POPUP._currentSection=o,p.text(n.text()),i.val("");var t=[];GSF_ICON_POPUP._fonts[GSF_ICON_POPUP._currentFontId]&&GSF_ICON_POPUP._fonts[GSF_ICON_POPUP._currentFontId].groups&&(t=GSF_ICON_POPUP._fonts[GSF_ICON_POPUP._currentFontId].groups[o]),GSF_ICON_POPUP.bindListFont(t,!1),GSF_ICON_POPUP.updateListingScroll()}),o.on("change",function(){var n=GSF_ICON_POPUP._$popup.find(".gsf-popup-icon-font-link-inner").find(".gsf-popup-icon-group-link"),o=GSF_ICON_POPUP._$popup.find(".gsf-popup-icon-group-section"),t=GSF_ICON_POPUP._$popup.find(".gsf-popup-icon-search > input");GSF_ICON_POPUP._currentFontId=s(this).val(),GSF_ICON_POPUP._currentSection="",n.fadeOut(),o.fadeOut(),n.each(function(){var n=s(this);n.data("font-id")===GSF_ICON_POPUP._currentFontId&&n.fadeIn(function(){GSF_ICON_POPUP.updateLinkScroll()})}),o.each(function(){var n=s(this);n.data("font-id")===GSF_ICON_POPUP._currentFontId&&n.fadeIn(function(){GSF_ICON_POPUP.updateListingScroll()})}),t.val(""),t.trigger("keyup")}),this.iconLoadMore()},iconLoadMore:function(){GSF_ICON_POPUP._$popup.find(".gsf-popup-icon-group-load-more >  button").on("click",function(){var n=s(this).closest(".gsf-popup-icon-group-section"),t=GSF_ICON_POPUP._$popup.find(".gsf-popup-icon-search > input").val(),i=n.find(" > ul > li").length,o=[];""!==t?GSF_ICON_POPUP._fonts[GSF_ICON_POPUP._currentFontId]&&GSF_ICON_POPUP._fonts[GSF_ICON_POPUP._currentFontId].groups&&(o=GSF_ICON_POPUP._fonts[GSF_ICON_POPUP._currentFontId].groups[""].filter(function(n,o){return i<=o&&-1!==n.indexOf(t)})):GSF_ICON_POPUP._fonts[GSF_ICON_POPUP._currentFontId]&&GSF_ICON_POPUP._fonts[GSF_ICON_POPUP._currentFontId].groups&&(o=GSF_ICON_POPUP._fonts[GSF_ICON_POPUP._currentFontId].groups[GSF_ICON_POPUP._currentSection].filter(function(n,o){return i<=o})),GSF_ICON_POPUP.bindListFont(o,!0)})},iconClickEvent:function(n){n.find("i").on("click",function(){GSF_ICON_POPUP._$popup.find(".mfp-close").trigger("click"),GSF_ICON_POPUP._callback(s(this).attr("class"))})},updateLinkScroll:function(){s(".gsf-popup-icon-font-link-inner").perfectScrollbar("update")},updateListingScroll:function(){s(".gsf-popup-icon-listing").perfectScrollbar("update")},open:function(n,o){var t=GSF_ICON_POPUP._$popup.find(".gsf-popup-icon-search > input");GSF_ICON_POPUP._currentIcon=n,t.val(""),t.trigger("keyup"),"function"==typeof o&&(GSF_ICON_POPUP._callback=o),s.magnificPopup.open({items:{src:"#gsf-popup-icon-wrapper",type:"inline"},mainClass:"mfp-move-horizontal",callbacks:{open:function(){GSF_ICON_POPUP.updateLinkScroll(),GSF_ICON_POPUP.updateListingScroll()}},openDelay:0,removalDelay:100,midClick:!0})},close:function(){},bindListFont:function(n,o){var t=this._$popup.find('.gsf-popup-icon-group-section[data-font-id="'+this._currentFontId+'"]'),i=t.find(" > .gsf-popup-icon-group-load-more > button"),p="",P=0;for(var _ in n){if(160<++P)break;n[_]===this._currentIcon?p+='<li title="'+n[_]+'" class="active"><i class="'+n[_]+'"></i></li>':p+='<li title="'+n[_]+'"><i class="'+n[_]+'"></i></li>'}var c=s(p);GSF_ICON_POPUP.svg_icon(c),o?t.find(" > ul").append(c):t.find(" > ul").html(c),this.iconClickEvent(c),160<P?i.show():i.hide()},svg_icon:function(n){void 0===n&&(n=s("body")),n.find(".svg-icon").each(function(){var n=s(this),o=n.attr("class"),t=o.replace("svg-icon svg-icon-",""),i='<svg class="'+o+'" aria-hidden="true" role="img"> <use href="#'+t+'" xlink:href="#'+t+'"></use> </svg>';n.html(i)})}},s(document).ready(function(){GSF_ICON_POPUP.init()})}(jQuery);