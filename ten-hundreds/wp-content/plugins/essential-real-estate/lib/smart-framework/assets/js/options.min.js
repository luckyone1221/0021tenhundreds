var GSF_THEME_OPTION;(function(a){"use strict";GSF_THEME_OPTION={_isSavingData:false,init:function(){this.headerSize();this.affixHeader();this.backupListener();this.checkFieldChange();this.saveOptions();this.resetOptions();this.resetSection();this.windowResize();this.sectionClickedEvent();this.presetProcess();this.optionMessage();this.deletePreset()},optionMessage:function(){var e=a('<div class="gsf-theme-options-message gsf-warning">'+GSF_META_DATA.msgSaveWarning+"</div>"),t=a('<div class="gsf-theme-options-message gsf-success">'+GSF_META_DATA.msgSaveSuccess+"</div>");if(a(".gsf-theme-options-preset").length==0){a(".gsf-theme-options-action-inner").prepend(e).prepend(t)}else{a(".gsf-meta-box-fields").prepend(e).prepend(t)}},headerSize:function(){var e=a(".gsf-theme-options-action-wrapper"),t=e.find(".gsf-theme-options-action-inner");t.outerWidth(e.width())},affixHeader:function(){a(window).scroll(function(){var e=a(".gsf-theme-options-action-wrapper"),t=a(window).scrollTop(),s=e.offset().top;if(t>s-32){e.addClass("gsf-affix")}else{e.removeClass("gsf-affix")}})},windowResize:function(){a(window).resize(function(){GSF_THEME_OPTION.affixHeader();GSF_THEME_OPTION.headerSize()})},sectionClickedEvent:function(){a(document).on("gsf_section_changed",function(){GSF_THEME_OPTION.affixHeader();GSF_THEME_OPTION.headerSize()})},backupListener:function(){a(document).on("click",".gsf-theme-options-import",function(){var e=a("#_current_page").val(),t=a("#_current_preset").val();a.magnificPopup.open({items:{src:GSF_META_DATA.ajaxUrl+"?action=gsf_import_popup&_current_page="+e+"&_current_preset="+t,type:"ajax"},mainClass:"mfp-move-horizontal",callbacks:{ajaxContentAdded:function(){GSF_THEME_OPTION.importData(this.content);GSF_THEME_OPTION.exportData(this.content)}},openDelay:0,removalDelay:200,midClick:true})})},importData:function(e){e.find(".gsf-theme-options-backup-import button").on("click",function(){var t=a(this),e=t.parent().find("textarea").val();if(e==""){return}if(!confirm(GSF_META_DATA.msgConfirmImportData)){return}if(t.data("importing")){return}var s=a("#_wpnonce"),n=s.val(),i=a("#_current_page").val(),o=a("#_current_preset").val();t.data("importing",true);t.html('<i class="fa fa-spin fa-spinner"></i> '+t.data("importing-text"));a.ajax({url:GSF_META_DATA.ajaxUrl,data:{_wpnonce:n,_current_page:i,_current_preset:o,action:"gsf_import_theme_options",backup_data:e},type:"post",success:function(e){t.data("importing",false);t.html(t.data("import-text"));if(e==1){alert(GSF_META_DATA.msgImportDone);window.location.reload()}else{alert(GSF_META_DATA.msgImportError)}}})})},exportData:function(e){e.find(".gsf-theme-options-backup-export button").on("click",function(){var e=a("#_wpnonce"),t=e.val(),s=a("#_current_page").val(),n=a("#_current_preset").val();window.open(GSF_META_DATA.ajaxUrl+"?action=gsf_export_theme_options&_wpnonce="+t+"&_current_page="+s+"&_current_preset="+n,"_blank")})},checkFieldChange:function(){a(document).on("gsf_field_change",".gsf-field",function(){var e=a(".gsf-theme-options-message.gsf-warning"),t=a(".gsf-theme-options-message.gsf-success");if(t.is(":visible")){t.slideUp(function(){if(!e.is(":visible")){e.slideDown()}})}else{if(!e.is(":visible")){e.slideDown()}}window.onbeforeunload=GSF_THEME_OPTION.confirmWhenPageExit})},confirmWhenPageExit:function(e){if(!e)e=window.event;e.cancelBubble=true;e.returnValue="";if(e.stopPropagation){e.stopPropagation();e.preventDefault()}},resetSection:function(){a(document).on("click",".gsf-theme-options-reset-section",function(){if(GSF_THEME_OPTION._isSavingData){return}if(!confirm(GSF_META_DATA.msgConfirmResetSection)){return}var e=a(this),t=a("#_wpnonce"),s=t.val(),n=a("#_current_page").val(),i=a("#_current_preset").val(),o=a(".gsf-sections").find("li.active").data("id");GSF_THEME_OPTION.showLoading("reset_section");a.ajax({url:GSF_META_DATA.ajaxUrl,data:{_wpnonce:s,_current_page:n,_current_preset:i,action:"gsf_reset_section_options",section:o},type:"post",success:function(e){GSF_THEME_OPTION.hideLoading("reset_section");if(e==1){alert(GSF_META_DATA.msgResetSectionDone);window.location.reload()}else{alert(GSF_META_DATA.msgResetSectionError)}}})})},resetOptions:function(){a(document).on("click",".gsf-theme-options-reset-options",function(){if(GSF_THEME_OPTION._isSavingData){return}if(!confirm(GSF_META_DATA.msgConfirmResetOptions)){return}var e=a(this),t=a("#_wpnonce"),s=t.val(),n=a("#_current_page").val(),i=a("#_current_preset").val();GSF_THEME_OPTION.showLoading("reset_option");a.ajax({url:GSF_META_DATA.ajaxUrl,data:{_wpnonce:s,_current_page:n,_current_preset:i,action:"gsf_reset_theme_options"},type:"post",success:function(e){GSF_THEME_OPTION.hideLoading("reset_option");if(e==1){alert(GSF_META_DATA.msgResetOptionsDone);window.location.reload()}else{alert(GSF_META_DATA.msgResetOptionsError)}}})})},saveOptions:function(){a(window).bind("keydown",function(e){if(e.ctrlKey||e.metaKey){if("s"===String.fromCharCode(e.which).toLowerCase()){e.preventDefault();a(".gsf-theme-options-save-options",".gsf-theme-options-page").trigger("click");return false}}});a(".gsf-theme-options-form").ajaxForm({beforeSubmit:function(){if(GSF_THEME_OPTION._isSavingData){return false}GSF_THEME_OPTION.showLoading("save")},success:function(e){window.onbeforeunload=null;GSF_THEME_OPTION.hideLoading("save");if(e.success){var t=a(".gsf-theme-options-message.gsf-warning"),s=a(".gsf-theme-options-message.gsf-success");if(t.is(":visible")){t.slideUp(function(){s.slideDown()})}else{s.slideDown()}a(document).trigger("gsf_save_option_success")}}})},deletePreset:function(){a(document).on("click",".gsf-preset-action-delete",function(){if(GSF_THEME_OPTION._isSavingData){return}if(!confirm(GSF_META_DATA.msgConfirmDeletePreset)){return}var e=a(this),t=a("#_wpnonce"),s=t.val(),n=a("#_current_page").val(),i=a("#_current_preset").val();GSF_THEME_OPTION.showLoading("delete_preset");a.ajax({url:GSF_META_DATA.ajaxUrl,data:{_wpnonce:s,_current_page:n,_current_preset:i,action:"gsf_delete_preset"},type:"post",success:function(e){GSF_THEME_OPTION.hideLoading("delete_preset");if(e==1){a(".gsf-theme-options-preset-select li").first().trigger("click")}else{alert(GSF_META_DATA.msgDeletePresetError)}}})})},showLoading:function(e){var t=a(".gsf-meta-box-wrap"),s;t.addClass("in");GSF_THEME_OPTION._isSavingData=true;switch(e){case"save":{s=a(".gsf-theme-options-save-options");s.data("button-text",s.html());s.html('<i class="fa fa-spin fa-spinner"></i> '+GSF_META_DATA.msgSavingOptions);break}case"reset_option":{s=a(".gsf-theme-options-reset-options");s.data("button-text",s.html());s.html('<i class="fa fa-spin fa-spinner"></i> '+GSF_META_DATA.msgResettingOptions);break}case"reset_section":{s=a(".gsf-theme-options-reset-section");s.data("button-text",s.html());s.html('<i class="fa fa-spin fa-spinner"></i> '+GSF_META_DATA.msgResettingSection);break}case"delete_preset":{s=a(".gsf-preset-action-delete");s.data("button-text",s.html());s.html('<i class="fa fa-spin fa-spinner"></i> '+GSF_META_DATA.msgDeletingPreset);break}}},hideLoading:function(e){var t=a(".gsf-meta-box-wrap"),s;t.removeClass("in");GSF_THEME_OPTION._isSavingData=false;switch(e){case"save":{s=a(".gsf-theme-options-save-options");s.html(s.data("button-text"));break}case"reset_option":{s=a(".gsf-theme-options-reset-options");s.html(s.data("button-text"));break}case"reset_section":{s=a(".gsf-theme-options-reset-section");s.html(s.data("button-text"));break}case"delete_preset":{s=a(".gsf-preset-action-delete");s.html(s.data("button-text"));break}}},presetProcess:function(){a(document).on("click",function(e){if(a(e.target).closest(".gsf-theme-options-preset-select").length==0){a(".gsf-theme-options-preset-select").removeClass("in")}});a(document).on("click",".gsf-theme-options-preset-create",function(){a.magnificPopup.open({items:{src:"#gsf_options_preset_popup",type:"inline"},mainClass:"mfp-move-horizontal",callbacks:{open:function(){var e=a(".gsf-theme-options-preset-popup-content input");e.val("");setTimeout(function(){e.focus()},200)}},openDelay:0,removalDelay:100,midClick:true})});a(document).on("click",".gsf-theme-options-preset-select",function(){a(this).toggleClass("in")});a(".gsf-theme-options-preset-popup-content button").on("click",function(){var e=a(".gsf-theme-options-preset-popup-content input").val();if(e!=""){var s=a(this);if(s.hasClass("gsf-preset-creating")){return}s.addClass("gsf-preset-creating");var t=a("#_wpnonce"),n=t.val(),i=a("#_current_page").val(),o=a("#_current_preset").val();a(".gsf-theme-options-preset-popup-content button i").addClass("fa-spin fa-spinner");a.ajax({url:GSF_META_DATA.ajaxUrl,data:{_wpnonce:n,_current_page:i,_current_preset:o,_preset_title:e,action:"gsf_create_preset_options"},type:"post",success:function(e){a(".gsf-theme-options-preset-popup-content button i").removeClass("fa-spin fa-spinner");s.removeClass("gsf-preset-creating");a(".gsf-theme-options-preset-popup").find(".mfp-close").trigger("click");var t=a(e);a(".gsf-theme-options-page").html(t);t.find(".gsf-meta-box-wrap").each(function(){GSF.fields.initFields(a(this))});GSF_THEME_OPTION.saveOptions();GSF_THEME_OPTION.headerSize();GSF_THEME_OPTION.optionMessage();a(document).trigger("gsf_section_changed");a(".gsf-field").trigger("gsf_check_required");a(".gsf-field").trigger("gsf_check_preset");o=a("#_current_preset").val();GSF_THEME_OPTION.changeLocation(o)},error:function(){a(".gsf-theme-options-preset-popup-content button i").removeClass("fa-spin fa-spinner");s.removeClass("gsf-preset-creating")}})}});a(document).on("click",".gsf-theme-options-preset-select li",function(){if(a(".gsf-theme-options-message.gsf-warning").is(":visible")){if(!confirm(GSF_META_DATA.msgPreventChangeData)){return}}var e=a(this);if(e.hasClass("gsf-preset-creating")){return}var t=a("#_current_preset").val(),s=e.data("preset");if(t!=s){e.addClass("gsf-preset-creating");a(".gsf-theme-options-page").addClass("in");GSF_THEME_OPTION.getPresetOptions(s,e)}})},getPresetOptions:function(s,n){var e=a("#_current_page").val();a.ajax({url:GSF_META_DATA.ajaxUrl,data:{_current_page:e,_current_preset:s,action:"gsf_ajax_theme_options"},type:"post",success:function(e){window.onbeforeunload=null;if(n!=null){n.removeClass("gsf-preset-creating")}a(".gsf-theme-options-page").removeClass("in");a(".gsf-theme-options-preset-popup").find(".mfp-close").trigger("click");var t=a(e);a(".gsf-theme-options-page").html(t);t.find(".gsf-meta-box-wrap").each(function(){GSF.fields.initFields(a(this))});GSF_THEME_OPTION.headerSize();GSF_THEME_OPTION.saveOptions();GSF_THEME_OPTION.optionMessage();a(document).trigger("gsf_section_changed");a(".gsf-field").trigger("gsf_check_required");GSF_THEME_OPTION.changeLocation(s)},error:function(){if(n!=null){n.removeClass("gsf-preset-creating")}a(".gsf-theme-options-page").removeClass("in")}})},changeLocation:function(n){var e=window.location.href;if(n==""){e=e.replace(/(&_gsf_preset=)([^&]*)/g,function(e,t,s){return""})}else{if(e.match(/(&_gsf_preset=)([^&]*)/g)){e=e.replace(/(&_gsf_preset=)([^&]*)/g,function(e,t,s){return t+n})}else{e+="&_gsf_preset="+n}}window.history.pushState("","",e)}};a(document).ready(function(){GSF_THEME_OPTION.init()})})(jQuery);