var GSF_GalleryClass=function(e){this.$container=e};(function(d){"use strict";GSF_GalleryClass.prototype={init:function(){this.select();this.remove();this.sortable();this.changeField()},select:function(){var s=new GSF_Media,e=this.$container.find(".gsf-gallery-add");s.selectGallery(e,{filter:"image"},function(e){if(e.length){var i=d(s.clickedButton);var a=i.parent();var t=a.find('input[type="hidden"]');var r=t.val();var l=r.split("|");var n="";e.each(function(e){e=e.toJSON();if(l.indexOf(""+e.id)!=-1){return}if(r!=""){r+="|"+e.id}else{r=""+e.id}l.push(""+e.id);var i="";if(e.sizes.thumbnail==null){i=e.sizes.full.url}else{i=e.sizes.thumbnail.url}n+='<div class="gsf-gallery-image-preview" data-id="'+e.id+'">';n+='<div class="centered">';n+='<img src="'+i+'" alt=""/>';n+="</div>";n+='<span class="gsf-gallery-remove dashicons dashicons dashicons-no-alt"></span>';n+="</div>"});t.val(r);i.before(n);i.trigger("gsf-gallery-selected")}})},remove:function(){this.$container.on("click",".gsf-gallery-remove",function(){var e=d(this).parent();var i=e.parent();var a=i.find('input[type="hidden"]');e.remove();var t="";d(".gsf-gallery-image-preview",i).each(function(){if(t!=""){t+="|"+d(this).data("id")}else{t=""+d(this).data("id")}});a.val(t);i.trigger("gsf-gallery-removed")})},sortable:function(){this.$container.sortable({placeholder:"gsf-gallery-sortable-placeholder",items:".gsf-gallery-image-preview",update:function(e,i){var a=d(e.target);var t="";d(".gsf-gallery-image-preview",a).each(function(){if(t!=""){t+="|"+d(this).data("id")}else{t=""+d(this).data("id")}});var r=a.find('input[type="hidden"]');r.val(t);a.trigger("gsf-gallery-sortable-updated")}})},changeField:function(){var i=this;this.$container.on("gsf-gallery-selected gsf-gallery-removed gsf-gallery-sortable-updated ",function(e){i.$container.find("[data-field-control]").trigger("gsf_field_control_changed")})},getValue:function(){return this.$container.find("[data-field-control]").val()}}})(jQuery);