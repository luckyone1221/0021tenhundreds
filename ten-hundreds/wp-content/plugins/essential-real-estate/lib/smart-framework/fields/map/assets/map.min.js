var GSF_MapClass=function(e){this.$container=e};(function(a){"use strict";GSF_MapClass.prototype={init:function(){this.$location=this.$container.find(".gsf-map-location-field");this.$address=this.$container.find(".gsf-map-address input");this.$findAddress=this.$container.find(".gsf-map-address button");this.$canvas=this.$container.find(".gsf-map-canvas");this.geocoder=new google.maps.Geocoder;this.bindMap();this.mapListener();this.findAddress();this.autoComplete()},bindMap:function(){var e=this.$location.val(),t=this.$canvas.data("options");e=e?e.split(","):[-33.868419,151.193245];var n=new google.maps.LatLng(e[0],e[1]);var o={center:n,zoom:16,scrollwheel:false,streetViewControl:0,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.LEFT_BOTTOM}};if(t){o=a.extend(o,t)}this.map=new google.maps.Map(this.$canvas[0],o);this.marker=new google.maps.Marker({position:n,map:this.map,draggable:true})},mapListener:function(){var t=this;google.maps.event.addListener(t.map,"click",function(e){t.marker.setPosition(e.latLng);t.$location.val(e.latLng.lat()+","+e.latLng.lng());t.changeField()});google.maps.event.addListener(t.marker,"drag",function(e){t.$location.val(e.latLng.lat()+","+e.latLng.lng());t.changeField()})},findAddress:function(){var n=this;n.$findAddress.on("click",function(){var e=n.$address.val();n.geocoder.geocode({address:e},function(e,t){if(t===google.maps.GeocoderStatus.OK){n.map.setCenter(e[0].geometry.location);n.marker.setPosition(e[0].geometry.location);n.$location.val(e[0].geometry.location.lat()+","+e[0].geometry.location.lng());n.changeField()}})});n.$address.on("keydown",function(e){if(e.which===13){e.preventDefault();n.$findAddress.trigger("click")}})},autoComplete:function(){var o=this;o.$address.autocomplete({source:function(e,t){o.geocoder.geocode({address:e.term},function(e){t(a.map(e,function(e){return{label:e.formatted_address,value:e.formatted_address,latitude:e.geometry.location.lat(),longitude:e.geometry.location.lng()}}))})},select:function(e,t){var n=new google.maps.LatLng(t.item.latitude,t.item.longitude);o.map.setCenter(n);o.marker.setPosition(n);o.$location.val(t.item.latitude+","+t.item.longitude);o.changeField()}})},changeField:function(){this.$container.find(".gsf-map-location-field").trigger("gsf_field_control_changed")},getValue:function(){var o={};this.$container.find("[data-field-control]").each(function(){var e=a(this),t=e.attr("name"),n=t.replace(/^(.*)(\[)([^\]]*)(\])*$/g,function(e,t,n,o,a){return o});o[n]=e.val()});return o}}})(jQuery);