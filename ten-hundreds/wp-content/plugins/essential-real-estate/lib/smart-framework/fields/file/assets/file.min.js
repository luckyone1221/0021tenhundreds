var GSF_FileClass=function(i){this.$container=i};(function(r){"use strict";GSF_FileClass.prototype={init:function(){this.select();this.remove();this.sortable()},select:function(){var d=this,i=d.$container.find(".gsf-file-add > button"),o=d.$container.find(".gsf-field-file-inner"),e=o.data("lib-filter"),t={title:GSF_FILE_FIELD_META.title,button:GSF_FILE_FIELD_META.button},c=new GSF_Media;if(typeof e!="undefined"&&e!=null&&e!=""){t.filter=e}c.selectGallery(i,t,function(i){if(i.length){var e=r(c.clickedButton),t=d.$container.find('input[type="hidden"]'),n=t.val(),a=n.split("|"),s="",l=o.data("remove-text");i.each(function(i){i=i.toJSON();if(a.indexOf(""+i.id)!=-1){return}if(n!=""){n+="|"+i.id}else{n=""+i.id}a.push(""+i.id);s+='<div class="gsf-file-item" data-file-id="'+i.id+'">';s+='<span class="dashicons dashicons-media-document"></span>';s+='<div class="gsf-file-info">';s+='<a class="gsf-file-title" href="'+i.editLink+'" target="_blank">'+i.title+"</a>";s+='<div class="gsf-file-name">'+i.filename+"</div>";s+='<div class="gsf-file-action">';s+='<span class="gsf-file-remove"><span class="dashicons dashicons-no-alt"></span> '+l+"</span>";s+="</div>";s+="</div>";s+="</div>"});t.val(n);var f=r(s);e.parent().before(f);d.remove(f);d.changeField()}})},remove:function(i){if(typeof i==="undefined"){i=this.$container}var a=this;i.find(".gsf-file-remove").on("click",function(){var i=r(this).closest(".gsf-file-item");var e=i.parent();var t=e.find('input[type="hidden"]');i.remove();var n="";r(".gsf-file-item",e).each(function(){if(n!=""){n+="|"+r(this).data("file-id")}else{n=""+r(this).data("file-id")}});t.val(n);a.changeField()})},sortable:function(){var s=this;this.$container.sortable({placeholder:"gsf-file-sortable-placeholder",items:".gsf-file-item",handle:".dashicons-media-document",update:function(i,e){var t=r(i.target);var n="";r(".gsf-file-item",t).each(function(){if(n!=""){n+="|"+r(this).data("file-id")}else{n=""+r(this).data("file-id")}});var a=t.find('input[type="hidden"]');a.val(n);s.changeField()}})},changeField:function(){this.$container.find("[data-field-control]").trigger("gsf_field_control_changed")},getValue:function(){var i=[];this.$container.find("[data-field-control]").each(function(){i.push(r(this).val())});return i}}})(jQuery);