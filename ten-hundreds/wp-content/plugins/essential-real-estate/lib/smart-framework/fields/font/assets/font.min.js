var GSF_FontClass=function(n){this.$container=n};(function(o){"use strict";GSF_FontClass.prototype={init:function(){if(b.googleFonts!=null){this.initFont()}else{b.fontField.push(this)}},initFont:function(){var i=this,t=i.$container.find(".gsf-font-size-kind"),n=i.$container.find(".gsf-font-size-full"),e=i.$container.find(".gsf-font-size-value"),o=i.$container.find(".gsf-font-size-unit"),a=i.$container.find(".gsf-font-family > select"),l=i.$container.find(".gsf-font-weight-style > select"),s=i.$container.find(".gsf-font-weight"),f=i.$container.find(".gsf-font-style"),r=i.$container.find(".gsf-font-subsets"),c=i.$container.find(".gsf-font-subsets > select");var g="",u,d,v;for(var h in b.googleFonts){u=b.googleFonts[h];g+='<optgroup label="'+u["label"]+'">';for(v=0;v<u["items"].length;v++){d=u["items"][v];g+='<option value="'+d["family"]+'">'+d["family_label"]+"</option>"}g+="</optgroup>"}a.html(g);var F={allowEmptyOption:true,onChange:function(){var n=b.findFont(a.val());if(n!=null){t.val(n.kind);if(n.subsets.length>0){r.show();i.binderSubsets(n.subsets)}else{r.hide();c.val("")}i.binderFontVariants(n.variants);l.trigger("change")}if(!i.$container.data("init-done")){l.val(l.data("value"));c.val(c.data("value"));i.$container.data("init-done",true)}}},p=a.selectize(F),$=a.data("value");p[0].selectize.setValue($);e.on("change",function(){if(e.val()==""){n.val("")}else{n.val(e.val()+o.val())}i.changeField()});o.on("change",function(){if(o.val()==="em"){e.attr("step",.01)}else{e.attr("step",1)}if(e.val()==""){n.val("")}else{n.val(e.val()+o.val())}i.changeField()});l.on("change",function(){var n=l.val(),t=n.replace("italic",""),e=n.substring(t.length);s.val(t);f.val(e);i.changeField()})},binderSubsets:function(n){var t="",e;for(e=0;e<n.length;e++){t+='<option value="'+n[e]+'">'+n[e]+"</option>"}this.$container.find(".gsf-font-subsets > select").html(t)},binderFontVariants:function(n){var t="",e,i,o,a;for(e=0;e<n.length;e++){i=n[e];o=i.replace("italic","");a=i.substring(o.length);t+='<option value="'+(o+a)+'">'+o+(a==""?"":" "+a)+"</option>"}this.$container.find(".gsf-font-weight-style > select").html(t)},changeField:function(){this.$container.find("[data-field-control]").first().trigger("gsf_field_control_changed")},getValue:function(){var i={};this.$container.find("[data-field-control]").each(function(){var n=o(this),t=n.attr("name"),e=t.replace(/^(.*)(\[)([^\]]*)(\])*$/g,function(n,t,e,i,o){return i});i[e]=n.val()});return i}};var b={googleFonts:null,fontField:[],init:function(){o.ajax({url:GSF_META_DATA.ajaxUrl,data:{action:"gsf_get_fonts"},success:function(n){b.googleFonts=JSON.parse(n);setTimeout(function(){for(var n=0;n<b.fontField.length;n++){b.fontField[n].initFont()}},50)}})},findFont:function(n){var t,e,i=null;for(t in b.googleFonts){for(e=0;e<b.googleFonts[t]["items"].length;e++){i=b.googleFonts[t]["items"][e];if(i["family"]==n){return i}}}return null}};o(document).ready(function(){b.init()})})(jQuery);