var GSF_BackgroundClass=function(n){this.$container=n};(function(g){"use strict";GSF_BackgroundClass.prototype={init:function(){var c=this,n=c.$container.find(".gsf-background-color"),a=c.$container.find(".gsf-background-choose-image"),e=c.$container.find(".gsf-background-remove-image"),i=c.$container.find(".gsf-background-url"),o=c.$container.find(".gsf-background-image");var r=g.extend({change:function(){var n=g(this);setTimeout(function(){c.changeField()},50)},clear:function(){setTimeout(function(){c.changeField()},50)}},n.data("options"));n.wpColorPicker(r);var t=new GSF_Media;t.selectImage(a,{filter:"image"},function(n){if(n){var a=g(t.clickedButton).parent();i.val(n.url);o.val(n.id);c.changeField()}});e.on("click",function(){i.val("");o.val("");c.changePreview();c.changeField()});i.on("change",function(){g.ajax({url:GSF_META_DATA.ajaxUrl+"?action=gsf_get_attachment_id",data:{url:i.val()},type:"GET",error:function(){o.val("0");c.changeField()},success:function(n){o.val(n);c.changeField()}})});c.$container.find("[data-field-control]").on("change",function(){c.changePreview()});c.changePreview()},getValue:function(){var e={};this.$container.find("[data-field-control]").each(function(){var n=g(this),a=n.attr("name"),c=a.replace(/^(.*)(\[)([^\]]*)(\])*$/g,function(n,a,c,e,i){return e});e[c]=g(this).val()});return e},changeField:function(){this.$container.find(".gsf-background-color").trigger("gsf_field_control_changed");this.changePreview()},changePreview:function(){var n=this,a=n.$container.find(".gsf-background-color"),c=n.$container.find(".gsf-background-preview "),e=n.$container.find(".gsf-background-url").val(),i=n.$container.find(".gsf-background-repeat").val(),o=n.$container.find(".gsf-background-size").val(),r=n.$container.find(".gsf-background-position").val(),t=n.$container.find(".gsf-background-attachment").val();c.css("background-color",a.val());if(e!=""){c.css("background-image","url("+e+")");c.css("background-repeat",i);c.css("background-size",o);c.css("background-position",r);c.css("background-attachment",t)}else{c.css("background-image","");c.css("background-repeat","");c.css("background-size","");c.css("background-position","");c.css("background-attachment","")}}}})(jQuery);